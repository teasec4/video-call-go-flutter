# Video Call App - Концепция

## Описание
Приложение для видео звонков в режиме peer-to-peer с поддержкой текстового чата. Использует WebRTC для прямого соединения между участниками и WebSocket сигнальный сервер для обмена инициализационными данными.

## Технологический стек

### Frontend
- **Framework**: Flutter
- **WebRTC**: flutter_webrtc
- **Сигнализация**: web_socket_channel
- **Платформы**: Web, iOS, Android

### Backend
- **Язык**: Go
- **WebSocket**: gorilla/websocket
- **Архитектура**: Сигнальный сервер (не обрабатывает медиа)

## Основные компоненты

### 1. Сигнальный сервер (Backend)
Управляет обменом сигнальными сообщениями между клиентами:
- Генерирует уникальные ID клиентов
- Маршрутизирует WebRTC offer/answer/ICE-candidates
- Ведет список подключенных пиров
- Доставляет сообщения чата

**Порт**: 8081  
**Endpoint**: `/ws`

### 2. Frontend приложение
Клиентское приложение для видео звонков:
- Получение медиа со своего устройства (камера + микрофон)
- Инициирование/прием звонков
- Отправка и получение видео/аудио потоков
- Текстовый чат с другими клиентами
- Управление медиа (включение/отключение микрофона)

## Функции

### Реализованные ✓
- [x] Видео звонки (peer-to-peer)
- [x] Аудио звонки
- [x] Текстовый чат
- [x] Автоматическое обнаружение пиров
- [x] Буферизация ICE candidates
- [x] Toggle микрофона во время звонка
- [x] Отображение списка доступных пиров
- [x] Локальное и удаленное видео

### Планируется
- [ ] Комнаты/сессии (вместо прямого списка пиров)
- [ ] Улучшение UI
- [ ] Рефакторинг структуры кода
- [ ] Toggle камеры
- [ ] Экранный шеринг
- [ ] Запись звонков
- [ ] Улучшенная обработка ошибок

## Потоки данных

```
Клиент A               Сигнальный сервер              Клиент B
    |                          |                          |
    |---- WebSocket connect ---|                          |
    |---- client-id message ----|                          |
    |                          |---- WebSocket connect ---|
    |                          |---- client-id message ----|
    |                          |                          |
    | (видит Клиента B в списке)    (видит Клиента A в списке)
    |                          |                          |
    |-- initiate call -------->|                          |
    |       offer              |---- offer message ------->|
    |                          |                          |
    |                          |<---- answer message ------|
    |<------- answer --------------|                      |
    |                          |                          |
    |<---- ICE candidates ---->|---- ICE candidates ----->|
    |                          |<---- ICE candidates -----|
    |                          |                          |
    |========== P2P WebRTC соединение ==========|          |
    |              Video/Audio/Data              ---------|
    |                          |                          |
```

## Сигнальные сообщения

| Тип | От | К | Описание |
|-----|-------|---------|-------------|
| client-id | Server | Client | Отправка ID клиента |
| peer-list | Server | Client | Список доступных пиров |
| peer-joined | Server | All | Уведомление о присоединении нового пира |
| peer-left | Server | All | Уведомление об отключении пира |
| offer | Client | Peer | WebRTC offer SDP |
| answer | Client | Peer | WebRTC answer SDP |
| ice-candidate | Client | Peer | ICE candidate для P2P соединения |
| chat | Client | All | Текстовое сообщение |
